# Development Notes

## 2023-09-05

- ( 2023-09-05 10:48:15 )
```
jazzwang:~/git$ git clone git@github.com:jazzwang/dotnet-codespace.git
Cloning into 'dotnet-codespace'...
warning: You appear to have cloned an empty repository.
jazzwang:~/git$ cd dotnet-codespace/
jazzwang:~/git/dotnet-codespace$ ls
jazzwang:~/git/dotnet-codespace$ cp ~/.gitconfig .
jazzwang:~/git/dotnet-codespace$ vi .gitconfig
jazzwang:~/git/dotnet-codespace$ git gi csharp > .gitignore
jazzwang:~/git/dotnet-codespace$ git add .
jazzwang:~/git/dotnet-codespace$ git commit -a
jazzwang:~/git/dotnet-codespace$ git push -u origin main
```
- ( 2023-09-05 10:51:42 )
```
jazzwang:~/git/dotnet-codespace$ code README.md
```
- Ref: https://gist.github.com/tianhaoz95/5bf47c416b4b641d83a2022f977a0ec0
- ( 2023-09-05 10:55:07 )
```
jazzwang:~/git/dotnet-codespace$ git add .
jazzwang:~/git/dotnet-codespace$ git commit -a
[main 75f344b] add `open in gitpod` to README.md
 2 files changed, 12 insertions(+)
 create mode 100644 README.md
jazzwang:~/git/dotnet-codespace$ git push
```
- ( 2023-09-05 10:58:19 )
```
jazzwang:~/git/dotnet-codespace$ mkdir sbin; code sbin/install-dotnet
jazzwang:~/git/dotnet-codespace$ code sbin/enable-dotnet
jazzwang:~/git/dotnet-codespace$ git add sbin/.
jazzwang:~/git/dotnet-codespace$ git commit -a ; git push
```
- ( 2023-09-05 03:37:38 )
```
gitpod /workspace/dotnet-codespace (main) $ chmod a+x sbin/install-dotnet
gitpod /workspace/dotnet-codespace (main) $ sbin/install-dotnet
gitpod /workspace/dotnet-codespace (main) $ cat .gitconfig >> .git/config
gitpod /workspace/dotnet-codespace (main) $ cat >> .gitignore << EOF
# 2023-09-05 - ignore .dotnet runtime for gitpod
.dotnet
EOF
gitpod /workspace/dotnet-codespace (main) $ git commit -a ; git push
```

### Testing C# REPL

- ( 2023-09-04 22:03:16 )
- C# REPL Reference: https://dev.to/tallesl/c-repl-gkn
```
gitpod /workspace/dotnet-codespace (main) $ export HOME=$(pwd)
gitpod ~ (main) $ dotnet tool install -g dotnet-script

Welcome to .NET 6.0!
---------------------
SDK Version: 6.0.413

Telemetry
---------
The .NET tools collect usage data in order to help us improve your experience. It is collected by Microsoft and shared with the community. You can opt-out of telemetry by setting the DOTNET_CLI_TELEMETRY_OPTOUT environment variable to '1' or 'true' using your favorite shell.

Read more about .NET CLI Tools telemetry: https://aka.ms/dotnet-cli-telemetry

----------------
Installed an ASP.NET Core HTTPS development certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only).
Learn about HTTPS: https://aka.ms/dotnet-https
----------------
Write your first app: https://aka.ms/dotnet-hello-world
Find out what's new: https://aka.ms/dotnet-whats-new
Explore documentation: https://aka.ms/dotnet-docs
Report issues and find source on GitHub: https://github.com/dotnet/core
Use 'dotnet --help' to see available commands or visit: https://aka.ms/dotnet-cli
--------------------------------------------------------------------------------------
Tools directory '/workspace/dotnet-codespace/.dotnet/tools' is not currently on the PATH environment variable.
If you are using bash, you can add it to your profile by running the following command:

cat << \EOF >> ~/.bash_profile
# Add .NET Core SDK tools
export PATH="$PATH:/workspace/dotnet-codespace/.dotnet/tools"
EOF

You can add it to the current session by running the following command:

export PATH="$PATH:/workspace/dotnet-codespace/.dotnet/tools"

You can invoke the tool using the following command: dotnet-script
Tool 'dotnet-script' (version '1.4.0') was successfully installed.
```
- ( 2023-09-05 05:03:33 )
```
gitpod /workspace/dotnet-codespace (main) $ dotnet script
Could not execute because the specified command or file was not found.
Possible reasons for this include:
  * You misspelled a built-in dotnet command.
  * You intended to execute a .NET program, but dotnet-script does not exist.
  * You intended to run a global tool, but a dotnet-prefixed executable with this name could not be found on the PATH.
gitpod /workspace/dotnet-codespace (main) $ dotnet-script
bash: dotnet-script: command not found
```

### Building AWS Lambda Functions

- ( 2023-09-05 04:20:18 )
- Reference: https://docs.aws.amazon.com/lambda/latest/dg/lambda-csharp.html

## 2023-09-11

- ( 2023-09-11 14:06:50 )
- [AWS SkillBuilder] .NET Workloads on AWS Lambda
- https://explore.skillbuilder.aws/learn/course/15308/net-workloads-on-aws-lambda

### Unit 1: Introduction

- ( 2023-09-11 14:14:47 )
- Serverless Computing
  - AWS offers options for serverless computing, including
    - **AWS Fargate** for container-based applications, and
    - **AWS Lambda** for event-driven applications.
- AWS Lambda
  - Lambda is a serverless compute service that runs your code in response to **events generated by other AWS services**:
    - Amazon Simple Notification Service (**Amazon SNS**),
    - Amazon Simple Queue Service (**Amazon SQS**),
    - Amazon Simple Storage Service (**Amazon S3**),
    - **Amazon DynamoDB**, and
    - **Amazon API Gateway**.
  - can run in multiple Availability Zones in each Region.
  - The Lambda infrastructure, managed by AWS, is **highly available** and **fault tolerant**.
  - All you need to decide is
    - the **processor architecture** and
    - the **amount of memory** to allocate to the function.
  - You can run your **.NET Lambda functions** on **x86_64** and **arm64** processors.

- **Tutorials 1, 2, and 3**
  - ( 2023-09-11 15:09:31 )
  - https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet#options-for-displaying-environment-information-and-available-commands
    ```csharp
    gitpod /workspace/dotnet-codespace (main) $ dotnet --list-runtimes
    Microsoft.AspNetCore.App 6.0.21 [/workspace/dotnet-codespace/.dotnet/shared/Microsoft.AspNetCore.App]
    Microsoft.NETCore.App 6.0.21 [/workspace/dotnet-codespace/.dotnet/shared/Microsoft.NETCore.App]
    gitpod /workspace/dotnet-codespace (main) $ dotnet --list-sdks
    6.0.413 [/workspace/dotnet-codespace/.dotnet/sdk]
    ```
  - **Tools and templates**
  - Instructions from document
  ```sh
  dotnet tool install -g Amazon.Lambda.Tools
  dotnet new -i Amazon.Lambda.Templates
  ```
  - ( 2023-09-11 15:18:20 )
  - real practice
  ```sh
  gitpod /workspace/dotnet-codespace (main) $ cat sbin/enable-dotnet
  export PATH=$PATH:$(pwd)/.dotnet
  ## Reference:
  ## - https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-environment-variables#net-sdk-and-cli-environment-variables
  export DOTNET_ROOT=$(pwd)/.dotnet
  export NUGET_PACKAGES=$(pwd)/.nuget/packages
  export DOTNET_CLI_TELEMETRY_OPTOUT=true
  gitpod /workspace/dotnet-codespace (main) $ source sbin/enable-dotnet
  gitpod /workspace/dotnet-codespace (main) $ dotnet tool install -g Amazon.Lambda.Tools
  Tools directory '/home/gitpod/.dotnet/tools' is not currently on the PATH environment variable.
  If you are using bash, you can add it to your profile by running the following command:

  cat << \EOF >> ~/.bash_profile
  # Add .NET Core SDK tools
  export PATH="$PATH:/home/gitpod/.dotnet/tools"
  EOF

  You can add it to the current session by running the following command:

  export PATH="$PATH:/home/gitpod/.dotnet/tools"

  You can invoke the tool using the following command: dotnet-lambda
  Tool 'amazon.lambda.tools' (version '5.8.0') was successfully installed.

  gitpod /workspace/dotnet-codespace (main) $ dotnet new -i Amazon.Lambda.Templates
  The following template packages will be installed:
    Amazon.Lambda.Templates

  Success: Amazon.Lambda.Templates::6.14.0 installed the following templates:
  Template Name                                                                         Short Name                                    Language  Tags
  ------------------------------------------------------------------------------------  --------------------------------------------  --------  --------------------------------
  Empty Top-level Function                                                              lambda.EmptyTopLevelFunction                  [C#]      AWS/Lambda/Serverless
  Lambda Annotations Framework Sample                                                   serverless.Annotations                        [C#]      AWS/Lambda/Serverless
  Lambda ASP.NET Core Minimal API                                                       serverless.AspNetCoreMinimalAPI               [C#]      AWS/Lambda/Serverless
  Lambda ASP.NET Core Web API                                                           serverless.AspNetCoreWebAPI                   [C#],F#   AWS/Lambda/Serverless
  Lambda ASP.NET Core Web API (.NET 6 Container Image)                                  serverless.image.AspNetCoreWebAPI             [C#],F#   AWS/Lambda/Serverless
  Lambda ASP.NET Core Web Application with Razor Pages                                  serverless.AspNetCoreWebApp                   [C#]      AWS/Lambda/Serverless
  Lambda Custom Runtime Function (.NET 7)                                               lambda.CustomRuntimeFunction                  [C#],F#   AWS/Lambda/Function
  Lambda Detect Image Labels                                                            lambda.DetectImageLabels                      [C#],F#   AWS/Lambda/Function
  Lambda Empty Function                                                                 lambda.EmptyFunction                          [C#],F#   AWS/Lambda/Function
  Lambda Empty Function (.NET 7 Container Image)                                        lambda.image.EmptyFunction                    [C#],F#   AWS/Lambda/Function
  Lambda Empty Serverless                                                               serverless.EmptyServerless                    [C#],F#   AWS/Lambda/Serverless
  Lambda Empty Serverless (.NET 7 Container Image)                                      serverless.image.EmptyServerless              [C#],F#   AWS/Lambda/Serverless
  Lambda Function project configured for deployment using .NET 7's Native AOT feature.  lambda.NativeAOT                              [C#],F#   AWS/Lambda/Function
  Lambda Function with Powertools for AWS Lambda (.NET)                                 lambda.Powertools                             [C#]      AWS/Lambda/Function/Powertools
  Lambda Giraffe Web App                                                                serverless.Giraffe                            F#        AWS/Lambda/Serverless
  Lambda Serverless with Powertools for AWS Lambda (.NET)                               serverless.Powertools                         [C#]      AWS/Lambda/Serverless/Powertools
  Lambda Simple Application Load Balancer Function                                      lambda.SimpleApplicationLoadBalancerFunction  [C#]      AWS/Lambda/Function
  Lambda Simple DynamoDB Function                                                       lambda.DynamoDB                               [C#],F#   AWS/Lambda/Function
  Lambda Simple Kinesis Firehose Function                                               lambda.KinesisFirehose                        [C#]      AWS/Lambda/Function
  Lambda Simple Kinesis Function                                                        lambda.Kinesis                                [C#],F#   AWS/Lambda/Function
  Lambda Simple S3 Function                                                             lambda.S3                                     [C#],F#   AWS/Lambda/Function
  Lambda Simple SNS Function                                                            lambda.SNS                                    [C#]      AWS/Lambda/Function
  Lambda Simple SQS Function                                                            lambda.SQS                                    [C#]      AWS/Lambda/Function
  Lex Book Trip Sample                                                                  lambda.LexBookTripSample                      [C#]      AWS/Lambda/Function
  Order Flowers Chatbot Tutorial                                                        lambda.OrderFlowersChatbot                    [C#]      AWS/Lambda/Function
  Serverless Detect Image Labels                                                        serverless.DetectImageLabels                  [C#],F#   AWS/Lambda/Serverless
  Serverless project configured for deployment using .NET 7's Native AOT feature.       serverless.NativeAOT                          [C#],F#   AWS/Lambda/Serverless
  Serverless Simple S3 Function                                                         serverless.S3                                 [C#],F#   AWS/Lambda/Serverless
  Serverless WebSocket API                                                              serverless.WebSocketAPI                       [C#]      AWS/Lambda/Serverless
  Step Functions Hello World                                                            serverless.StepFunctionsHelloWorld            [C#],F#   AWS/Lambda/Serverless

  gitpod /workspace/dotnet-codespace (main) $
  ```

| Tutoroal | Description | File Size |
|--|--|--|
| Tutorial 1 | .NET Tools for AWS Lambda.pdf               | 3 MB |
| Tutorial 2 | The Hello World of Lambda Functions.pdf     | 672.6 KB |
| Tutorial 3 | A .NET API Running in a Lambda Function.pdf | 246 KB |

### Unit 2: .NET on AWS Lambda

- You can create and deploy .NET applications on Lambda in several ways.
  - You can invoke **functions** directly to return a string, such as "Hello World!"
  - You can also create and deploy a **full web API application** that can respond to all HTTP commands
  - build a **suite of Lambda functions** orchestrated by **AWS Step Functions**.

## 2023-09-12

- ( 2023-09-12 15:56:17 )
- Supported versions of .NET
  - 1. managed runtime provided by AWS
    - As of January 2023, AWS only offers managed runtimes for long-term support (LTS) versions of .NET runtime:
      - **.NET 3.1**
      - **.NET 6**
    - The .NET managed runtimes are available for both **x86_64** and **arm64** architectures and run on **Amazon Linux 2**.
    - PS. available Lambda runtimes - https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html
  - 2. custom runtime
    - pass `--self-contained true` to the `dotnet build`` command.
    - using the `aws-lambda-tools-defaults.json` file with the following parameter: `"msbuild-parameters": "--self-contained true"`
    - To help reduce this size, consider using the .NET compilation features [Trimming](https://docs.microsoft.com/en-us/dotnet/core/deploying/trimming/trim-self-contained) and also [ReadyToRun](https://docs.microsoft.com/en-us/dotnet/core/deploying/ready-to-run).
  - 3. container image
    - AWS provides various **[base images](https://gallery.ecr.aws/lambda/dotnet) for .NET and .NET Core** to help get you started.
      - see the Dockerfiles in [this repository](https://github.com/aws/aws-lambda-dotnet/tree/master/LambdaRuntimeDockerfiles/Images).
    - Images of up to **10 GB** are supported
- Invoking a .NET Lambda function
  - You can invoke a .NET Lambda function with:
    -  a string,
    - JSON object
    - HTTP request
    - Amazon S3 (when an object change occurs)
    - Kinesis (when an event arrives)
    - DynamoDB (when a change occurs on a table)
    - Amazon SNS (when a message arrives)
    - AWS Step Functions
    - a stream. However - this is a less common scenario. For more information, see the page on [handling streams](https://docs.aws.amazon.com/lambda/latest/dg/csharp-handler.html#csharp-handler-streams)

  - ( 2023-09-12 16:29:53 )
  - Function Handler
    - Each Lambda function has a single function handler.
      - If you look at the `aws-lambda-tools-defaults.json`, you can see the `"function-handler":`  specified.
    - Along with the **JSON input**, the Lambda function handler can also take an **optional `ILambdaContext` object**.
    - `ILambdaContext` object gives you access to information about the current invocation, such as
      - the **time it has left to complete**,
      - the **function name**, and
      - **version**.
  - ( 2023-09-12 16:40:27 )
  - JSON input
    - If you wanted to call a Lambda function in response to a file change on an S3 bucket, you must create a Lambda function that accepts **an object of type S3Event**.
    ```c#
    public async string FunctionHandler(S3Event s3Event, ILambdaContext context)
    {
      ...
    }
    ```
    - Here are some of the common packages you might use to handle events from other services:
      - https://www.nuget.org/packages/Amazon.Lambda.S3Events
      - https://www.nuget.org/packages/Amazon.Lambda.SNSEvents
      - https://www.nuget.org/packages/Amazon.Lambda.DynamoDBEvents
      - https://www.nuget.org/packages/Amazon.Lambda.CloudWatchEvents
      - https://www.nuget.org/packages/Amazon.Lambda.KinesisEvents
      - https://www.nuget.org/packages/Amazon.Lambda.APIGatewayEvents

## 2023-09-13

  - ( 2023-09-13 23:13:14 )
  - Serialization